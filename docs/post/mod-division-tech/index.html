<!DOCTYPE html>
<html lang="ja">
<head>





<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>割れるし割りたいのに割れない数を割る方法 - InTheDayDream</title>
<meta name="description" content="">

<meta name="author" content="">

<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="alternate" href="/index.xml?c=b728eb92f518d77b7d49779615527899c381dc0c" type="application/rss+xml" title="RSS" />
<meta property="og:title" content="割れるし割りたいのに割れない数を割る方法 - InTheDayDream">
</meta>
<meta property="og:url" content="http://inthebloom.github.io/post/mod-division-tech/">
<meta property="og:type" content="article">
<meta property="og:site_name" content="InTheDayDream">
<meta property="og:description" content="">

<meta property="og:image" content="http://inthebloom.github.io//images/featured_image.jpg">

<meta name="twitter:card" content="summary_large_image" /></meta>
<meta name="twitter:site" content="@UU9782wsEdANDhp"></meta>
<meta name="twitter:creator" content="@UU9782wsEdANDhp"></meta>
<meta name="twitter:title" content="割れるし割りたいのに割れない数を割る方法 - InTheDayDream"></meta>
<meta name="twitter:url" content="http://inthebloom.github.io/post/mod-division-tech/"></meta>
<meta name="twitter:description" content=""></meta>

<meta property="og:image" content="http://inthebloom.github.io//images/featured_image.jpg">


<link rel="stylesheet" href="/css/main.css?c=b728eb92f518d77b7d49779615527899c381dc0c">
<link rel="stylesheet" href="/css/color.css?c=b728eb92f518d77b7d49779615527899c381dc0c">


<link rel="stylesheet" href="/css/custom.css?c=b728eb92f518d77b7d49779615527899c381dc0c">



</head>

<body class="theme-default">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              
              
          ],
          
          throwOnError : false
        });
    });
</script>



<div id="content-header" class="title">
  
  <a class="site-title" href="/">InTheDayDream</a>
  
  <span class="site-sub-title"></span>

  

  <div id="main-menu-nav">
    <div id="main-menu-nav-items">
      
        <div class="nav-item"><a href="/">Home</a></div>
      
        <div class="nav-item"><a href="/tags/">Tags</a></div>
      
        <div class="nav-item"><a href="/archives/">Archives</a></div>
      
        <div class="nav-item"><a href="/about/">About</a></div>
      
        <div class="nav-item"><a href="/search/">Search</a></div>
      
    </div>
  </div>
</div>
<div id="content" class="main">




<h1>割れるし割りたいのに割れない数を割る方法</h1>

<span class="sub">Published on 2023-10-05</span><br>
<span class="sub">Last Modified 2023-10-05</span>






<div style="padding: 0em 1em; margin-bottom: 5em; margin-top: 0.7em;">
    <p style="font-size: 1.3em;">Table Of Contents</p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#状況設定">状況設定</a>
      <ul>
        <li><a href="#問題">問題</a></li>
      </ul>
    </li>
    <li><a href="#何が厳しいのか">何が厳しいのか</a></li>
    <li><a href="#解答">解答</a></li>
    <li><a href="#応用例">応用例</a>
      <ul>
        <li><a href="#補足">補足</a></li>
      </ul>
    </li>
    <li><a href="#終わりに">終わりに</a></li>
  </ul>
</nav>
</div>



<h2 id="状況設定">状況設定</h2>
<ul>
<li>$x, ~ y, ~ z \in \mathbb N$</li>
<li>$x\%y = 0$</li>
<li>$1 &lt; \mathrm{gcd}(y, z)$</li>
<li>$x$は陽に求められないほど大きく、$y$、$z$は常識的な大きさ</li>
</ul>
<h3 id="問題">問題</h3>
<p>$xy^{-1}$を$z$で割った非負最小剰余を求めよ。</p>
<h2 id="何が厳しいのか">何が厳しいのか</h2>
<p>$\mathrm{gcd}(y, z) = 1$が満たされていれば話は終了です。
なぜなら、このような$y$は$\mathrm{mod} ~ z$上で逆元を持つからです。
普通に拡張ユークリッドの互除法などを用いれば答えられます。</p>
<p>問題はそうでない時です。
この時、$y$は逆元を持ちませんから、先に$\dfrac{x}{y}$を計算したくなります。
しかし、$x$はデカいので、陽に求めるのは無理です。
さてどうしましょう？</p>
<h2 id="解答">解答</h2>
<p>結論から言います。$\mathrm{mod} ~ yz$上で考えるとうまくいきます。</p>
<p>もう少し具体的には、次の手順を踏むことで答えることができます。</p>
<ol>
<li>$x ~ \mathrm{mod} ~ yz$を求める。</li>
<li>それを$y$で割る。</li>
</ol>
<p>正当性を追っていきます。</p>
<p>除法定理より、次を満たす整数$q, ~ r$の組がただ一つ存在します。</p>
<ul>
<li>$x = q(yz) + r$</li>
<li>$0 \leq r &lt; yz$</li>
</ul>
<p>ちなみに$r = x ~ \mathrm{mod} ~ yz$です。</p>
<p>ここで、$x\%y = 0$を仮定しているので、必ず$r\%y = 0$となっています。</p>
<p>両辺$y$で割ります。
$$
\begin{equation}
\frac{x}{y} = qz + \frac{r}{y}
\end{equation}
$$
です。</p>
<p>ここから少し定義に戻って確認します。
$\dfrac{x}{y} ~ \mathrm{mod} ~ z$を求めるとは
$$
\begin{equation}
\dfrac{x}{y} = q&rsquo;z + r&rsquo; ~ \left(  0 \leq r&rsquo; &lt; z  \right)
\end{equation}
$$
なる$r&rsquo;$を求めることです。
ここで、除法定理よりこのような整数の組$(q&rsquo;, r&rsquo;)$はただ一つに定まります。
さて、式(1)を見てみましょう。
$0 \leq r &lt; yz$でありますから、$0 \leq \dfrac{r}{y} &lt; z$であることが分かります。</p>
<p>式(2)と見比べてみましょう。$r&rsquo; = \dfrac{r}{y}$となっていることが確認できます。</p>
<p>なんということでしょう。求めることができてしまいました。除法定理が強力すぎますね。</p>
<h2 id="応用例">応用例</h2>
<p>実際にこのテクニックを使える問題を2問紹介します。</p>
<ol>
<li><a href="https://atcoder.jp/contests/arc111/tasks/arc111_a">ARC111A - Simple Math 2</a></li>
</ol>
<details>
<summary>解法</summary>
$10^N = qM + r ~ (0 \leq r < M)$と表すと、
$\left\lfloor \dfrac{10^N}{M} \right\rfloor = \left\lfloor \dfrac{qM + r}{M} \right\rfloor = q$
であるから、解は$q\%M$です。
これをもとに変形していきます。
<p>$$
qM = 10^N - r
$$
$$
q = \frac{10^N-r}{M}
$$</p>
<p>ここまで変形すると今回のテクニックに帰着します。
求めたいのは$q ~ \mathrm{mod} ~ M$ですが、$M$は$\mathrm{mod} ~ M$上で逆元を持ちません。
また、$10^N-r$も大きすぎて陽に求めるのは無理です。
そこで、$(10^N - r) ~ \mathrm{mod} ~ M^2$を計算してから最後に$M$で割ってやるとうまくいきます。</p>
<p>実装例(一部抜粋)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-d" data-lang="d"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">solve</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">long</span> N<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> M<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 10^N = qM + r (0&lt;=r&lt;M) を得たとき、解はq%M
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 両辺Mで剰余をとってみると、 (10^N)%M = r%M
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// 条件より、(10^N)%M = r
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 典型テク: mod MK (Mは最後に求めたい剰余、Kは割りたいけど法と互いに素でない数) で考える。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">long</span> ans <span style="color:#f92672">=</span> modPow<span style="color:#f92672">(</span><span style="color:#ae81ff">10</span><span style="color:#f92672">,</span> N<span style="color:#f92672">,</span> M<span style="color:#f92672">^^</span><span style="color:#ae81ff">2</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    ans <span style="color:#f92672">-=</span> modPow<span style="color:#f92672">(</span><span style="color:#ae81ff">10</span><span style="color:#f92672">,</span> N<span style="color:#f92672">,</span> M<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ans <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        ans <span style="color:#f92672">+=</span> M<span style="color:#f92672">^^</span><span style="color:#ae81ff">2</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ans <span style="color:#f92672">/=</span> M<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    writeln<span style="color:#f92672">(</span>ans<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></details>
<ol start="2">
<li><a href="https://atcoder.jp/contests/abc293/tasks/abc293_e">ABC293E - Geometric Progression</a></li>
</ol>
<details>
<summary>解法</summary>
解法がたくさんありますが、<a href="https://atcoder.jp/contests/abc293/editorial/5966">kyopro_friendsさんのユーザー解説</a>と同じ方法です。
<p>丁寧に式変形を追っていきます。</p>
<p>$S(x) \coloneqq \displaystyle\sum_{i=0}^{x}A^i$と定めます。</p>
<p>$0 \leq N$を用いて、</p>
<p>$$
\begin{alignat*}{3}
A \times S(N) &amp;= &amp;&amp;A^1 + A^2 + \cdots + A^N-1 + A^N + A^{N+1} \\
S(N) &amp;= A^0 + &amp;&amp;A^1 + A^2 + \cdots + A^N-1 + A^N \\
\end{alignat*}
$$</p>
<p>が成立します。そこで、</p>
<p>$$
A \times S(N) - S(N) = A^{N+1} - A^0
$$
となります。$S(N)$でくくると、
$$
(A-1) \times S(N) = A^{N+1} - 1
$$
です。$A-1 \neq 0$ならば、両辺を割れて、
$$
S(N) = \frac{A^{N+1}-1}{A-1}
$$
を得ます。</p>
<p>さて、今回求める値は$S(X-1) ~ \mathrm{mod} ~ M$にほかなりません。$A-1 \neq 0$のとき、$0 \leq X-1$なので、上式を適用できます。
$$
S(X-1) = \frac{A^X-1}{A-1}
$$
ここで、$A-1$は$\mathrm{mod} ~ M$上で逆元を持つとは限りません。今回のテクを使いましょう。
つまり、$\mathrm{mod} ~ M(A-1)$で考えるとうまくいきます。</p>
<p>注意点として、この値は法としてはかなり大きくなる(それでも十分常識の範囲ですが)ので、
計算途中で64bit整数型を超える可能性が高いです。128bit整数や、多倍長整数を使いましょう。
多倍長整数とはいえ、そこまで桁数は大きくならないので十分高速です。
よくわからない人はpythonを使うとよいです。</p>
<p>また、$A-1 = 0$の時はすべての項が1になるため、簡単に計算できます。</p>
<p>実装例(一部抜粋)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-d" data-lang="d"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">solve</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> A<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> X<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> M<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 解は (A^x - 1) / (A - 1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 場合分けが必要なケース
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>A <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        writeln<span style="color:#f92672">(</span>X<span style="color:#f92672">%</span>M<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    BigInt a <span style="color:#f92672">=</span> A<span style="color:#f92672">,</span> x <span style="color:#f92672">=</span> X<span style="color:#f92672">,</span> m <span style="color:#f92672">=</span> M<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    BigInt ans <span style="color:#f92672">=</span> std<span style="color:#f92672">.</span><span style="color:#a6e22e">bigint</span><span style="color:#f92672">.</span><span style="color:#a6e22e">powmod</span><span style="color:#f92672">(</span>a<span style="color:#f92672">,</span> x<span style="color:#f92672">,</span> m<span style="color:#f92672">*(</span>a<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">))</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ans <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">)</span> ans <span style="color:#f92672">+=</span> m<span style="color:#f92672">*(</span>a<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    ans <span style="color:#f92672">/=</span> A<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    writeln<span style="color:#f92672">(</span>ans<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></details>
<h3 id="補足">補足</h3>
<p>問題2の解法説明で、
「逆元を持つとは限りません」と書きましたが、逆元を持っていてもよいことに注意してください。
正当性の証明のパートを見ればわかるように、法と除数の関係性は正当性を示すのに用いていないためです。</p>
<p>もちろん$\mathrm{gcd}(M, A-1)$を計算して、逆元を持つ場合はそちらを経由するという方法でも解けます。</p>
<p>また、問題2に関しては、行列累乗による$O(\log(X))$解法や、平方分割による解法など勉強になる解法がたくさん紹介されています。
余裕のある人はぜひ学んでみてください。(ちなみに私は学べてないです。コーナーで差をつけろ！)</p>
<h2 id="終わりに">終わりに</h2>
<p>いつかまとめようと思っていたネタです。
ほんの思い付きで書き始めたつもりが約2時間たっていて現在深夜1時です。
助けてくれ。</p>
<p>このアイディア自体はまさに上で紹介したABC293Eのユーザー解説から得たものです。
かなり行間が広いと感じたので、そこを埋める目的で作りました。
なので、この主張がどこまで一般化できるのかなどは私はわかっていません。</p>
<p>誤りがありましたら指摘していただければありがたいです。</p>






<hr class="block-separater">




<div class="content-footer-item">
	Tags for this post:
	
	<a class="post-tag" href="/tags/%E7%AB%B6%E6%8A%80%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0/">競技プログラミング</a>
	
	<a class="post-tag" href="/tags/%E5%85%B8%E5%9E%8B%E3%83%86%E3%82%AF/">典型テク</a>
	
	<a class="post-tag" href="/tags/%E6%95%B0%E5%AD%A6/">数学</a>
	
</div>







<div class="content-footer-item neighbor">
	
	<div class="prev-post">Prev: <a href="/post/floyd-warshall/">ワーシャル・フロイド法について調べて、納得したこと</a></div>
	
	
	<div class="next-post">Next: <a href="/post/yuki407/">yukicoder contest407参加記録</a></div>
	
</div>











    
    
    
    <div class="related-tag-category-list">
        <h4 style="font-size: 1.3em;">Other posts tagged by "競技プログラミング"</h4>
        <ul class="post-list">
          
          <li class="post-item">
  <div class="post-date sub">2024-04-10</div>
  <div class="post-title"><a href="/post/abc247f/">ABC247F - Cards</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2024-04-08</div>
  <div class="post-title"><a href="/post/abc247e/">ABC247E - Max Min</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2024-04-03</div>
  <div class="post-title"><a href="/post/mmacontest018/">MMA Contest 018参加記録 &#43; 怪文書</a></div>
  
</li>
          
        </ul>
        <div class="more-area">
          
          <a class="more" href='/tags/%e7%ab%b6%e6%8a%80%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0/'>more ...</a>
          
      </div>
        </div>
    

    
    
    
    <div class="related-tag-category-list">
        <h4 style="font-size: 1.3em;">Other posts tagged by "典型テク"</h4>
        <ul class="post-list">
          
          <li class="post-item">
  <div class="post-date sub">2024-03-14</div>
  <div class="post-title"><a href="/post/sumitb2019f/">三井住友信託銀行プログラミングコンテスト2019F - Interval Running</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2024-03-12</div>
  <div class="post-title"><a href="/post/abc35d/">ABC35D - トレジャーハント</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2024-02-22</div>
  <div class="post-title"><a href="/post/two-pointer-approach/">尺取り法備忘録</a></div>
  
</li>
          
        </ul>
        <div class="more-area">
          
          <a class="more" href='/tags/%e5%85%b8%e5%9e%8b%e3%83%86%e3%82%af/'>more ...</a>
          
      </div>
        </div>
    

    
    
    
    <div class="related-tag-category-list">
        <h4 style="font-size: 1.3em;">Other posts tagged by "数学"</h4>
        <ul class="post-list">
          
          <li class="post-item">
  <div class="post-date sub">2024-02-15</div>
  <div class="post-title"><a href="/post/geometric-progression-sum/">等比数列の和を計算する2つの対数時間アルゴリズム</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2023-11-06</div>
  <div class="post-title"><a href="/post/abc100d/">ABC100D - Patisserie ABC</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2023-10-05</div>
  <div class="post-title"><a href="/post/mod-division-tech/">割れるし割りたいのに割れない数を割る方法</a></div>
  
</li>
          
        </ul>
        <div class="more-area">
          
          <a class="more" href='/tags/%e6%95%b0%e5%ad%a6/'>more ...</a>
          
      </div>
        </div>
    




<script src="/js/single.js"></script>





	</div><div id="content-footer" class="sub">
  
  <div class="credit">
    Power by <a href="https://gohugo.io">Hugo</a> /
    Theme <a href="https://github.com/michimani/simplog/">simplog</a> by <a href="https://github.com/michimani/">michimani</a>
  </div>
</div></body>

</html>